{% extends 'base/index.html' %}
{% load static %}
{% load range_tags %}

{% block title %}Products{% endblock %}

{% block body %}
    <main class="page-product">
  <div class="container">
    <!-- Product Info Section -->
    <section class="product-details-section">
      <div class="product-image-container">
        <img src="{{ object.image.url }}" alt="{{ object.name }}" class="product-image">
      </div>
      <div class="product-info-column">
        <div class="product-title-price">
          <h1 class="product-name">{{ object.name }}</h1>
          <div class="price-section">
            <span class="price-tag">{{ object.category.name }}</span>
            <p class="product-price">${{ object.price }}</p>
          </div>
        </div>
        <div class="product-description">
            {{ object.description|linebreaks }}
        </div>
        {% if user.is_authenticated %}
        <div class="cart-controls">
          <button class="button button--primary add-to-cart-button" id="add-to-cart-btn">
            <i class="fa-solid fa-cart-shopping"></i>
            <span>Add to Cart</span>
          </button>
          <div class="quantity-counter is-hidden" id="quantity-counter">
            <button class="quantity-btn" data-action="decrease" aria-label="Decrease quantity"><i class="fa-solid fa-minus"></i></button>
            <span class="quantity-value">1 in cart</span>
            <button class="quantity-btn" data-action="increase" aria-label="Increase quantity"><i class="fa-solid fa-plus"></i></button>
          </div>
        </div>
            {% if not cant_review %}
                <div class="review">
                    <button class="button add-review-button" id="add-review-btn">
                        <i class="fa-solid fa-message"></i>
                        <span>Add Review</span>
                    </button>
                </div>
            {% endif %}
        {% endif %}
      </div>
    </section>

    <!-- Latest Reviews Section -->
    {% if user.is_authenticated and not cant_review %}
    <section class="reviews-form-section hide" id="reviews-form-section">
        <div class="review-form">
            <form action="{% url 'products:add-review' %}?next={{ request.path }}" method="post" class="review-form">
                {% csrf_token %}
                <input hidden="hidden" name="{{ review_form.user.name }}" value="{{ user.pk }}" />
                <input hidden="hidden" name="{{ review_form.product.name }}" value="{{ object.pk }}" />
                <div class="Rating">
                    {% for value, label in rating_choices %}
                        <label>
                            <input type="radio" name="{{ review_form.rating.name }}" value="{{ value }}" required>
                            <span class="star">â˜…</span>
                        </label>
                    {% endfor %}
                </div>
                <div class="comment">
                    {{ review_form.comment }}
                </div>

                <button type="submit" class="button add-review-button mt-2">
                    <i class="fa-solid fa-message"></i>
                    <span>Save Review</span>
                </button>
            </form>
        </div>
    </section>
    {% endif %}

    <section class="reviews-section">
      <h2 class="reviews-title">Latest reviews</h2>
        {% if reviews %}
            {% for r in reviews %}
            <div class="reviews-grid">
                <div class="review-card">
                  <div class="review-rating">
                    {% for i in 5|times %}
                        {% if i < r.rating %}
                            <i class="fa-solid fa-star star star--gold"></i>
                        {% else %}
                            <i class="fa-solid fa-star star star--gray"></i>
                        {% endif %}
                    {% endfor %}
                  </div>
                  <div class="review-body">
                    <p class="review-text">{{ r.comment|linebreaks }}</p>
                  </div>
                  <div class="review-author">
                    <img src="{% static '/img/icons/User_alt.svg' %}" alt="User Account" class="author-avatar">
                    <span class="author-name">{{ r.user.username }}</span>
                  </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
          <div class="reviews-empty">Reviews list is empty</div>
        {% endif %}
    </section>
  </div>
</main>
{% endblock %}